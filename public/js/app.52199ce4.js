(function(){"use strict";var e={6816:function(e,t,s){var a=s(9242),i=s(3396),n=s(7139);const r={key:0,class:"master-box"},o={class:"content"},l={key:0,class:"cover"},c={class:"upload-limit"},d=(0,i.Uk)("上传的文件"),u=(0,i.Uk)("选项"),f={class:"switch-group"},p=(0,i.Uk)("彩色打印"),m=(0,i.Uk)("双面打印"),v={class:"bottom"},h={class:"error"},g={key:0},_=(0,i.Uk)("似乎有人正在执行双面打印，"),w=(0,i._)("br",null,null,-1),x=(0,i.Uk)("请稍后提交打印。"),b=[_,w,x],k={key:1},y=(0,i.Uk)("提交打印"),D={key:0,class:"master-box"},C=(0,i._)("div",{class:"duplex-info"},"需要翻转纸张以继续双面打印。",-1),W={class:"bottom"},I={class:"error"},U=(0,i.Uk)("继续双面打印"),F={key:0,class:"master-box"},O=(0,i._)("div",{class:"duplex-info"},"打印操作完毕，谢谢惠顾。",-1),z=(0,i.Uk)("观星"),Y=(0,i._)("div",{class:"duplex-info stargaze"},"天高云耀彗赫隐，际远风啸流龙吟。",-1),P={class:"bottom"},A=(0,i.Uk)("再打印些什么");function $(e,t,s,_,w,x){const $=(0,i.up)("file-upload"),S=(0,i.up)("LineBreak"),j=(0,i.up)("ProgressIndicator"),T=(0,i.up)("SwitchBar"),Z=(0,i.up)("AnimatedButton"),B=(0,i.up)("FlipAnimation"),q=(0,i.up)("PrintCompletion");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(a.uT,{name:"stage1","enter-from-class":"enter-from","enter-to-class":"enter-to","leave-from-class":"leave-from","leave-to-class":"leave-to"},{default:(0,i.w5)((()=>["submitting"==w.stage||"ready"==w.stage?((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("div",o,["submitting"==w.stage?((0,i.wg)(),(0,i.iD)("div",l)):(0,i.kq)("",!0),(0,i._)("div",{class:(0,n.C_)(["content-inner",{disabled:"submitting"==w.stage}])},[(0,i._)("div",{class:(0,n.C_)(["uploader",{limit:w.files.length>=5}])},[(0,i.wy)((0,i.Wm)($,{accept:".pdf",onUpload:x.upload},null,8,["onUpload"]),[[a.F8,w.files.length<5]]),(0,i.wy)((0,i._)("div",c,"文件数量已达到上限（5个）。",512),[[a.F8,w.files.length>=5]])],2),(0,i.wy)((0,i.Wm)(S,null,{default:(0,i.w5)((()=>[d])),_:1},512),[[a.F8,w.files.length]]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(w.files,((e,t)=>((0,i.wg)(),(0,i.j4)(j,{key:t,manifest:e,onRemove:t=>x.removeFile(e)},null,8,["manifest","onRemove"])))),128)),(0,i.wy)((0,i.Wm)(S,null,{default:(0,i.w5)((()=>[u])),_:1},512),[[a.F8,w.files.length]]),(0,i.wy)((0,i._)("div",f,[(0,i.Wm)(T,{class:"switch",active:w.color,onClick:t[0]||(t[0]=e=>w.color=!w.color)},{default:(0,i.w5)((()=>[p])),_:1},8,["active"]),(0,i.Wm)(T,{class:"switch",active:w.duplex,onClick:t[1]||(t[1]=e=>w.duplex=!w.duplex)},{default:(0,i.w5)((()=>[m])),_:1},8,["active"])],512),[[a.F8,w.files.length]])],2)]),(0,i._)("div",v,[(0,i._)("div",h,[w.serverDuplex?((0,i.wg)(),(0,i.iD)("span",g,b)):((0,i.wg)(),(0,i.iD)("span",k,(0,n.zw)(w.errmsg),1))]),(0,i.Wm)(Z,{class:"animated-button",active:"ready"!=w.stage,disabled:!x.printReady||w.serverDuplex,onClick:t[2]||(t[2]=e=>x.submitPrint())},{default:(0,i.w5)((()=>[y])),_:1},8,["active","disabled"])])])):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(a.uT,{name:"stage2","enter-from-class":"enter-from","enter-to-class":"enter-to","leave-from-class":"leave-from","leave-to-class":"leave-to"},{default:(0,i.w5)((()=>["duplexSubmitting"==w.stage||"duplexWaiting"==w.stage?((0,i.wg)(),(0,i.iD)("div",D,[C,(0,i.Wm)(B,{class:"flip-animation"}),(0,i._)("div",W,[(0,i._)("div",I,[(0,i._)("span",null,(0,n.zw)(w.errmsg),1)]),(0,i.Wm)(Z,{class:"animated-button",active:"duplexWaiting"!=w.stage,onClick:t[3]||(t[3]=e=>x.continueDuplex())},{default:(0,i.w5)((()=>[U])),_:1},8,["active"])])])):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(a.uT,{name:"stage3","enter-from-class":"enter-from","enter-to-class":"enter-to","leave-from-class":"leave-from","leave-to-class":"leave-to"},{default:(0,i.w5)((()=>["finished"==w.stage?((0,i.wg)(),(0,i.iD)("div",F,[O,(0,i.Wm)(S,null,{default:(0,i.w5)((()=>[z])),_:1}),Y,(0,i.Wm)(q,{class:"flip-animation"}),(0,i._)("div",P,[(0,i.Wm)(Z,{class:"animated-button",onClick:t[4]||(t[4]=e=>x.reload())},{default:(0,i.w5)((()=>[A])),_:1})])])):(0,i.kq)("",!0)])),_:1})],64)}const S=["accept"],j=(0,i._)("div",{class:"add-icon"},null,-1),T=(0,i._)("div",{class:"add-text"},"上传PDF文件",-1);function Z(e,t,s,n,r,o){return(0,i.wg)(),(0,i.iD)("div",{class:"file-upload",onDrop:t[1]||(t[1]=(0,a.iM)(((...e)=>o.dropped&&o.dropped(...e)),["prevent"])),onClick:t[2]||(t[2]=(...e)=>o.clicked&&o.clicked(...e)),onFocus:t[3]||(t[3]=e=>this.inputActive=!1)},[(0,i._)("input",{type:"file",class:"file-input",ref:"input",multiple:"",onChange:t[0]||(t[0]=(...e)=>o.inputUpload&&o.inputUpload(...e)),accept:o.InputFormats},null,40,S),j,T],32)}var B={props:["accept"],data(){return{files:[]}},computed:{acceptedFormats(){let e=[];if(this.accept){let t=this.accept;Array.isArray(t)||(t=[t]);for(let s=0;s<t.length;s++)0==t[s].indexOf(".")&&e.push(t[s])}return e},InputFormats(){let e="";if(this.accept){let t=this.accept;Array.isArray(t)||(t=[t]);for(let s=0;s<t.length;s++)if(e.length&&(e+=","),0==t[s].indexOf("."))e+=t[s];else switch(t[s]){case"image":e+="image/*";break;default:break}}return e}},methods:{clicked(){this.$refs.input.click()},inputUpload(){this.emitFiles(this.$refs.input.files),this.$refs.input.value=""},dropped(e){this.emitFiles(e.dataTransfer.files)},emitFiles(e){let t=[];for(let s=0;s<e.length;s++)-1!=this.acceptedFormats.indexOf(e[s].name.slice(e[s].name.lastIndexOf(".")))&&t.push(e[s]);t.length&&this.$emit("upload",t)}}},q=s(89);const H=(0,q.Z)(B,[["render",Z]]);var M=H;const R={class:"progress-indicator"},N=(0,i._)("div",{class:"file-icon"},null,-1),E={class:"info"},L={class:"filename"},K={class:"progress"},G={class:"progress-text"},J={class:"progress-box"};function Q(e,t,s,r,o,l){return(0,i.wg)(),(0,i.iD)("div",R,[N,(0,i._)("div",E,[(0,i._)("div",L,(0,n.zw)(s.manifest.name),1),(0,i._)("div",K,[(0,i._)("div",G,(0,n.zw)(s.manifest.completed?"上传完成":Math.floor(s.manifest.progress)+"%"),1),(0,i.wy)((0,i._)("div",J,[(0,i._)("div",{class:"progress-bar",style:(0,n.j5)("width:"+s.manifest.progress+"%")},null,4)],512),[[a.F8,!s.manifest.completed]])])]),(0,i._)("div",{class:"remove-icon",onClick:t[0]||(t[0]=(...e)=>l.remove&&l.remove(...e))})])}var V={name:"ProgressIndicator",props:["manifest"],methods:{remove(){this.$emit("remove")}}};const X=(0,q.Z)(V,[["render",Q]]);var ee=X,te=s(6265),se=s.n(te),ae=s(4870);const ie={class:"switch"},ne={class:"switch-text"},re={class:"switch-frame"};function oe(e,t,s,a,r,o){return(0,i.wg)(),(0,i.iD)("div",ie,[(0,i._)("div",ne,[(0,i.WI)(e.$slots,"default")]),(0,i._)("div",re,[(0,i._)("div",{class:(0,n.C_)(["switch-box",{active:s.active}])},[(0,i._)("div",{class:(0,n.C_)(["switch-button",{active:s.active}])},null,2)],2)])])}var le={props:["active"]};const ce=(0,q.Z)(le,[["render",oe]]);var de=ce;const ue=e=>((0,i.dD)("data-v-ea00fb32"),e=e(),(0,i.Cn)(),e),fe={class:"line-break"},pe={class:"text"},me=ue((()=>(0,i._)("div",{class:"hr-break-line"},null,-1)));function ve(e,t){return(0,i.wg)(),(0,i.iD)("div",fe,[(0,i._)("span",pe,[(0,i.WI)(e.$slots,"default",{},void 0,!0)]),me])}const he={},ge=(0,q.Z)(he,[["render",ve],["__scopeId","data-v-ea00fb32"]]);var _e=ge;const we={class:"button-frame"};function xe(e,t,s,r,o,l){return(0,i.wg)(),(0,i.iD)("div",we,[(0,i._)("div",{class:(0,n.C_)(["animated-button",{active:s.active,disabled:s.disabled}]),ref:"button",onClick:t[0]||(t[0]=(0,a.iM)(((...e)=>l.clicked&&l.clicked(...e)),["stop"]))},[(0,i._)("div",{class:(0,n.C_)(["spinner",{hide:!s.active}])},null,2),(0,i._)("span",{class:(0,n.C_)({hide:s.active})},[(0,i.WI)(e.$slots,"default",{},void 0,!0)],2),(0,i._)("div",{class:(0,n.C_)(["button-text",{hide:s.active}])},(0,n.zw)(s.text),3)],2)])}var be={data(){return{}},props:["text","active","disabled"],methods:{clicked(){this.disabled||this.active||this.$emit("click","clicked!")}}};const ke=(0,q.Z)(be,[["render",xe],["__scopeId","data-v-6a7f42c2"]]);var ye=ke;const De={class:"flip-animation"},Ce=(0,i._)("div",{class:"notice"},"请在偶数面全部打印完毕后",-1),We=(0,i._)("div",{class:"notice"},"按照演示一并翻转全部纸张并插回纸槽",-1),Ie=(0,i._)("div",{class:"notice"},"然后点击下方的”继续“键",-1),Ue={class:"animation"},Fe=(0,i._)("div",{class:"printer"},null,-1),Oe={class:"paperbox",ref:"paperbox"},ze={class:"paper",ref:"paper"},Ye=(0,i.Uk)("===="),Pe=(0,i._)("br",null,null,-1),Ae=(0,i.Uk)("==="),$e=(0,i._)("br",null,null,-1),Se=(0,i.Uk)("===="),je=(0,i._)("br",null,null,-1),Te=(0,i.Uk)("=="),Ze=[Ye,Pe,Ae,$e,Se,je,Te];function Be(e,t,s,a,n,r){return(0,i.wg)(),(0,i.iD)("div",De,[Ce,We,Ie,(0,i._)("div",Ue,[Fe,(0,i._)("div",Oe,[(0,i._)("div",ze,Ze,512)],512)])])}var qe={mounted(){this.$refs.paperbox.animate([{transform:"rotate3d(1,0,0,50deg)",zIndex:1,offset:0,easing:"ease-out"},{transform:"rotate3d(1,0,0,50deg)",zIndex:1,offset:.15,easing:"ease-in-out"},{transform:"rotate3d(1,0,0,0deg)",zIndex:3,offset:.3},{transform:"rotate3d(0,1,0,0deg)",zIndex:3,offset:.4,easing:"ease-in-out"},{transform:"rotate3d(0,1,0,180deg)",zIndex:3,offset:.6},{transform:"rotate3d(0,1,0,0deg) translateY(0rem)",zIndex:3,offset:.6},{transform:"rotate3d(1,0,0,0deg) translateY(0rem)",zIndex:3,offset:.62,easing:"ease-out"},{transform:"rotate3d(1,0,0,-60deg) translateY(-50rem)",zIndex:3,offset:.8},{transform:"rotate3d(1,0,0,-60deg) translateY(-50rem)",zIndex:3,offset:1}],{duration:7200,iterations:1/0}),this.$refs.paper.animate([{transform:"translateY(120rem)",color:"#909090",opacity:0,offset:0,easing:"ease-out"},{opacity:1,offset:.1},{transform:"translateY(240rem)",color:"#909090",offset:.15,easing:"ease-in-out"},{transform:"translateY(70rem)",color:"#909090",offset:.3},{transform:"translateY(70rem)",color:"#909090",offset:.48},{transform:"translateY(70rem)",color:"transparent",offset:.5},{transform:"translateY(70rem)",color:"transparent",offset:.62,easing:"ease-out"},{transform:"translateY(-20rem)",color:"transparent",offset:.8,easing:"ease-in-out"},{transform:"translateY(0rem)",color:"transparent",offset:.9},{opacity:1,offset:.93},{opacity:0,offset:.99},{transform:"translateY(0rem)",color:"transparent",opacity:0,offset:1}],{duration:7200,iterations:1/0})}};const He=(0,q.Z)(qe,[["render",Be]]);var Me=He;const Re={class:"completion"},Ne=(0,i._)("div",{class:"notice"},"打印指令已经全部提交完毕",-1),Ee=(0,i._)("div",{class:"notice"},"请等待打印完毕",-1),Le=(0,i._)("div",{class:"notice"},"然后取走打印好的文档",-1),Ke=[Ne,Ee,Le];function Ge(e,t){return(0,i.wg)(),(0,i.iD)("div",Re,Ke)}const Je={},Qe=(0,q.Z)(Je,[["render",Ge]]);var Ve=Qe;function Xe(e){return new Promise(((t,s)=>{window.confirm(e)?t():s()}))}var et={name:"App",data(){return{stage:"",files:[],socket:{status:3},duplex:!1,color:!1,errmsg:"",serverDuplex:!1}},components:{FileUpload:M,ProgressIndicator:ee,SwitchBar:de,LineBreak:_e,AnimatedButton:ye,FlipAnimation:Me,PrintCompletion:Ve},methods:{update(){se().get("http://"+location.host+"/api/status").then((e=>{this.serverDuplex=e.data.duplex.active,e.data.duplex.uuid&&e.data.duplex.uuid==localStorage.getItem("duplexUuid")&&"duplexWaiting"!=this.stage&&"duplexSubmitting"!=this.stage&&(this.stage="duplexWaiting")})).catch((e=>{this.errmsg=e.toString()}))},reload(){location.reload()},async upload(e){e.length+this.files.length>5&&(e=e.slice(0,5-this.files.length)),e.forEach((async e=>{let t={name:e.name,progress:(0,ae.iH)(0),completed:(0,ae.iH)(!1),controller:new AbortController,remoteName:""};this.files.push(t);let s=new FormData;s.append("file",e);let{data:a}=await se()({method:"post",url:"http://"+location.host+"/api/upload",data:s,signal:t.controller.signal,onUploadProgress:e=>{t.progress.value=100*e.loaded/e.total},headers:{"Content-Type":"multipart/form-data"}});a.success&&(setTimeout((()=>{t.completed.value=!0}),300),t.remoteName=a.path)}))},submitPrint(){Xe("要提交打印这"+this.files.length+"个文件吗？").then((()=>{this.stage="submitting";let e=[];for(let t=this.files.length-1;t>=0;t--)e.push(this.files[t].remoteName);console.log(e),se()({method:"post",url:"http://"+location.host+"/api/print",data:{config:{paths:e,duplex:this.duplex,mono:!this.color}}}).then((e=>{e.data.success?e.data.uuid?(localStorage.setItem("duplexUuid",e.data.uuid),this.stage="duplexWaiting"):this.stage="finished":(this.errmsg=e.data.err,this.stage="ready",this.update())})).catch((e=>{this.errmsg=e.toString(),this.stage="ready",this.update()}))}))},continueDuplex(){Xe("确认已经全部偶数页已经打印完毕，并已按提示翻转纸张？").then((()=>{this.stage="duplexSubmitting",se()({method:"post",url:"http://"+location.host+"/api/duplex"}).then((e=>{e.data.success?this.stage="finished":(this.errmsg=e.data.err,this.stage="duplexWaiting",this.update())})).catch((e=>{this.errmsg=e.toString(),this.stage="duplexWaiting",this.update()}))}))},removeFile(e){Xe("要删除列表中的“"+e.name+"”吗？").then((()=>{e.completed.value||e.controller.abort(),this.files.splice(this.files.indexOf(e),1)}))}},computed:{printReady(){if(this.files.length){for(let e=0;e<this.files.length;e++)if(!this.files[e].completed)return!1;return!0}return!1}},mounted(){this.stage="ready",this.update(),setInterval((()=>{this.update()}),5e3)}};const tt=(0,q.Z)(et,[["render",$]]);var st=tt;(0,a.ri)(st).mount("#app")}},t={};function s(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,i,n){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],i=e[d][1],n=e[d][2];for(var o=!0,l=0;l<a.length;l++)(!1&n||r>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(o=!1,n<r&&(r=n));if(o){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,i,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var i,n,r=a[0],o=a[1],l=a[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(i in o)s.o(o,i)&&(s.m[i]=o[i]);if(l)var d=l(s)}for(t&&t(a);c<r.length;c++)n=r[c],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(d)},a=self["webpackChunkprint_service_frontend"]=self["webpackChunkprint_service_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[998],(function(){return s(6816)}));a=s.O(a)})();