(function(){"use strict";var e={5613:function(e,t,i){var s=i(9242),a=i(3396),n=i(7139);const l={key:0,class:"master-box"},r={class:"content"},o={key:0,class:"cover"},c={class:"upload-limit"},d=(0,a.Uk)("上传的文件"),u=(0,a.Uk)("选项"),p={class:"switch-group"},f=(0,a.Uk)("彩色打印"),v=(0,a.Uk)("双面打印"),m={class:"bottom"},h={class:"error"},g={key:0},_=(0,a.Uk)("似乎有人正在执行双面打印，"),b=(0,a._)("br",null,null,-1),w=(0,a.Uk)("请稍后提交打印。"),x=[_,b,w],k={key:1},y=(0,a.Uk)("提交打印"),D={key:0,class:"master-box"},C=(0,a._)("div",{class:"duplex-info"},"需要将纸张翻面以继续双面打印。",-1),W={class:"bottom"},F={class:"error"},U=(0,a.Uk)("继续双面打印"),O={key:0,class:"master-box"},I=(0,a._)("div",{class:"duplex-info"},"打印操作完毕，谢谢惠顾。",-1),P=(0,a.Uk)("观星"),A=(0,a._)("div",{class:"duplex-info stargaze"},"天高云耀彗赫隐，际远风啸流龙吟。",-1),S={class:"bottom"},$=(0,a.Uk)("再打印些什么");function j(e,t,i,_,b,w){const j=(0,a.up)("file-upload"),T=(0,a.up)("LineBreak"),Z=(0,a.up)("ProgressIndicator"),z=(0,a.up)("SwitchBar"),B=(0,a.up)("AnimatedButton"),q=(0,a.up)("FlipAnimation"),H=(0,a.up)("PrintCompletion");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(s.uT,{name:"stage1","enter-from-class":"enter-from","enter-to-class":"enter-to","leave-from-class":"leave-from","leave-to-class":"leave-to"},{default:(0,a.w5)((()=>["submitting"==b.stage||"ready"==b.stage?((0,a.wg)(),(0,a.iD)("div",l,[(0,a._)("div",r,["submitting"==b.stage?((0,a.wg)(),(0,a.iD)("div",o)):(0,a.kq)("",!0),(0,a._)("div",{class:(0,n.C_)(["content-inner",{disabled:"submitting"==b.stage}])},[(0,a._)("div",{class:(0,n.C_)(["uploader",{limit:b.files.length>=5}])},[(0,a.wy)((0,a.Wm)(j,{accept:".pdf",onUpload:w.upload},null,8,["onUpload"]),[[s.F8,b.files.length<5]]),(0,a.wy)((0,a._)("div",c,"文件数量已达到上限（5个）。",512),[[s.F8,b.files.length>=5]])],2),(0,a.wy)((0,a.Wm)(T,null,{default:(0,a.w5)((()=>[d])),_:1},512),[[s.F8,b.files.length]]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(b.files,((e,t)=>((0,a.wg)(),(0,a.j4)(Z,{key:t,manifest:e,onRemove:t=>w.removeFile(e)},null,8,["manifest","onRemove"])))),128)),(0,a.wy)((0,a.Wm)(T,null,{default:(0,a.w5)((()=>[u])),_:1},512),[[s.F8,b.files.length]]),(0,a.wy)((0,a._)("div",p,[(0,a.Wm)(z,{class:"switch",active:b.color,onClick:t[0]||(t[0]=e=>b.color=!b.color)},{default:(0,a.w5)((()=>[f])),_:1},8,["active"]),(0,a.Wm)(z,{class:"switch",active:b.duplex,onClick:t[1]||(t[1]=e=>b.duplex=!b.duplex)},{default:(0,a.w5)((()=>[v])),_:1},8,["active"])],512),[[s.F8,b.files.length]])],2)]),(0,a._)("div",m,[(0,a._)("div",h,[b.serverDuplex?((0,a.wg)(),(0,a.iD)("span",g,x)):((0,a.wg)(),(0,a.iD)("span",k,(0,n.zw)(b.errmsg),1))]),(0,a.Wm)(B,{class:"animated-button",active:"ready"!=b.stage,disabled:!w.printReady||b.serverDuplex,onClick:t[2]||(t[2]=e=>w.submitPrint())},{default:(0,a.w5)((()=>[y])),_:1},8,["active","disabled"])])])):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(s.uT,{name:"stage2","enter-from-class":"enter-from","enter-to-class":"enter-to","leave-from-class":"leave-from","leave-to-class":"leave-to"},{default:(0,a.w5)((()=>["duplexSubmitting"==b.stage||"duplexWaiting"==b.stage?((0,a.wg)(),(0,a.iD)("div",D,[C,(0,a.Wm)(q,{class:"flip-animation"}),(0,a._)("div",W,[(0,a._)("div",F,[(0,a._)("span",null,(0,n.zw)(b.errmsg),1)]),(0,a.Wm)(B,{class:"animated-button",active:"duplexWaiting"!=b.stage,onClick:t[3]||(t[3]=e=>w.continueDuplex())},{default:(0,a.w5)((()=>[U])),_:1},8,["active"])])])):(0,a.kq)("",!0)])),_:1}),(0,a.Wm)(s.uT,{name:"stage3","enter-from-class":"enter-from","enter-to-class":"enter-to","leave-from-class":"leave-from","leave-to-class":"leave-to"},{default:(0,a.w5)((()=>["finished"==b.stage?((0,a.wg)(),(0,a.iD)("div",O,[I,(0,a.Wm)(T,null,{default:(0,a.w5)((()=>[P])),_:1}),A,(0,a.Wm)(H,{class:"flip-animation"}),(0,a._)("div",S,[(0,a.Wm)(B,{class:"animated-button",onClick:t[4]||(t[4]=e=>w.reload())},{default:(0,a.w5)((()=>[$])),_:1})])])):(0,a.kq)("",!0)])),_:1})],64)}const T=["accept"],Z=(0,a._)("div",{class:"add-icon"},null,-1),z=(0,a._)("div",{class:"add-text"},"上传PDF文件",-1);function B(e,t,i,n,l,r){return(0,a.wg)(),(0,a.iD)("div",{class:"file-upload",onDrop:t[1]||(t[1]=(0,s.iM)(((...e)=>r.dropped&&r.dropped(...e)),["prevent"])),onClick:t[2]||(t[2]=(...e)=>r.clicked&&r.clicked(...e)),onFocus:t[3]||(t[3]=e=>this.inputActive=!1)},[(0,a._)("input",{type:"file",class:"file-input",ref:"input",multiple:"",onChange:t[0]||(t[0]=(...e)=>r.inputUpload&&r.inputUpload(...e)),accept:r.InputFormats},null,40,T),Z,z],32)}var q={props:["accept"],data(){return{files:[]}},computed:{acceptedFormats(){let e=[];if(this.accept){let t=this.accept;Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)0==t[i].indexOf(".")&&e.push(t[i])}return e},InputFormats(){let e="";if(this.accept){let t=this.accept;Array.isArray(t)||(t=[t]);for(let i=0;i<t.length;i++)if(e.length&&(e+=","),0==t[i].indexOf("."))e+=t[i];else switch(t[i]){case"image":e+="image/*";break;default:break}}return e}},methods:{clicked(){this.$refs.input.click()},inputUpload(){this.emitFiles(this.$refs.input.files),this.$refs.input.value=""},dropped(e){this.emitFiles(e.dataTransfer.files)},emitFiles(e){let t=[];for(let i=0;i<e.length;i++)-1!=this.acceptedFormats.indexOf(e[i].name.slice(e[i].name.lastIndexOf(".")))&&t.push(e[i]);t.length&&this.$emit("upload",t)}}},H=i(89);const M=(0,H.Z)(q,[["render",B]]);var R=M;const E={class:"progress-indicator"},N=(0,a._)("div",{class:"file-icon"},null,-1),L={class:"info"},Y={class:"filename"},K={class:"progress"},G={class:"progress-text"},J={class:"progress-box"};function Q(e,t,i,l,r,o){return(0,a.wg)(),(0,a.iD)("div",E,[N,(0,a._)("div",L,[(0,a._)("div",Y,(0,n.zw)(i.manifest.name),1),(0,a._)("div",K,[(0,a._)("div",G,(0,n.zw)(i.manifest.completed?"上传完成":Math.floor(i.manifest.progress)+"%"),1),(0,a.wy)((0,a._)("div",J,[(0,a._)("div",{class:"progress-bar",style:(0,n.j5)("width:"+i.manifest.progress+"%")},null,4)],512),[[s.F8,!i.manifest.completed]])])]),(0,a._)("div",{class:"remove-icon",onClick:t[0]||(t[0]=(...e)=>o.remove&&o.remove(...e))})])}var V={name:"ProgressIndicator",props:["manifest"],methods:{remove(){this.$emit("remove")}}};const X=(0,H.Z)(V,[["render",Q]]);var ee=X,te=i(6265),ie=i.n(te),se=i(4870);const ae={class:"switch"},ne={class:"switch-text"},le={class:"switch-frame"};function re(e,t,i,s,l,r){return(0,a.wg)(),(0,a.iD)("div",ae,[(0,a._)("div",ne,[(0,a.WI)(e.$slots,"default")]),(0,a._)("div",le,[(0,a._)("div",{class:(0,n.C_)(["switch-box",{active:i.active}])},[(0,a._)("div",{class:(0,n.C_)(["switch-button",{active:i.active}])},null,2)],2)])])}var oe={props:["active"]};const ce=(0,H.Z)(oe,[["render",re]]);var de=ce;const ue=e=>((0,a.dD)("data-v-ea00fb32"),e=e(),(0,a.Cn)(),e),pe={class:"line-break"},fe={class:"text"},ve=ue((()=>(0,a._)("div",{class:"hr-break-line"},null,-1)));function me(e,t){return(0,a.wg)(),(0,a.iD)("div",pe,[(0,a._)("span",fe,[(0,a.WI)(e.$slots,"default",{},void 0,!0)]),ve])}const he={},ge=(0,H.Z)(he,[["render",me],["__scopeId","data-v-ea00fb32"]]);var _e=ge;const be={class:"button-frame"};function we(e,t,i,l,r,o){return(0,a.wg)(),(0,a.iD)("div",be,[(0,a._)("div",{class:(0,n.C_)(["animated-button",{active:i.active,disabled:i.disabled}]),ref:"button",onClick:t[0]||(t[0]=(0,s.iM)(((...e)=>o.clicked&&o.clicked(...e)),["stop"]))},[(0,a._)("div",{class:(0,n.C_)(["spinner",{hide:!i.active}])},null,2),(0,a._)("span",{class:(0,n.C_)({hide:i.active})},[(0,a.WI)(e.$slots,"default",{},void 0,!0)],2),(0,a._)("div",{class:(0,n.C_)(["button-text",{hide:i.active}])},(0,n.zw)(i.text),3)],2)])}var xe={data(){return{}},props:["text","active","disabled"],methods:{clicked(){this.disabled||this.active||this.$emit("click","clicked!")}}};const ke=(0,H.Z)(xe,[["render",we],["__scopeId","data-v-6a7f42c2"]]);var ye=ke;const De={class:"flip-animation"},Ce=(0,a.uE)('<div class="notice">请等待偶数面全部打印完毕后</div><div class="notice">按照演示一并翻转全部纸张并插回纸槽</div><div class="notice">然后点击下方的”继续“键</div><div class="animation"><div class="printer"></div><div class="paperbox"><div class="paperframe"><div class="paper" id="paper1">====<br>===<br>====<br>==</div><div class="paper" id="paper2">lorem<br>ipsum<br>sit<br>amet</div><div class="paper" id="paper3"></div></div></div></div>',4),We=[Ce];function Fe(e,t){return(0,a.wg)(),(0,a.iD)("div",De,We)}const Ue={},Oe=(0,H.Z)(Ue,[["render",Fe]]);var Ie=Oe;const Pe={class:"completion"},Ae=(0,a._)("div",{class:"notice"},"打印指令已经全部提交完毕",-1),Se=(0,a._)("div",{class:"notice"},"请等待打印完毕",-1),$e=(0,a._)("div",{class:"notice"},"然后取走打印好的文档",-1),je=[Ae,Se,$e];function Te(e,t){return(0,a.wg)(),(0,a.iD)("div",Pe,je)}const Ze={},ze=(0,H.Z)(Ze,[["render",Te]]);var Be=ze;function qe(e){return new Promise(((t,i)=>{window.confirm(e)?t():i()}))}var He={name:"App",data(){return{stage:"",files:[],socket:{status:3},duplex:!1,color:!1,errmsg:"",serverDuplex:!1}},components:{FileUpload:R,ProgressIndicator:ee,SwitchBar:de,LineBreak:_e,AnimatedButton:ye,FlipAnimation:Ie,PrintCompletion:Be},methods:{reload(){location.reload()},update(){"submitting"!=this.stage&&"duplexSubmitting"!=this.stage&&ie().get("http://"+location.host+"/api/status").then((e=>{this.serverDuplex=e.data.duplex.active,e.data.duplex.uuid&&e.data.duplex.uuid==localStorage.getItem("duplexUuid")&&"duplexWaiting"!=this.stage&&"duplexSubmitting"!=this.stage&&(this.stage="duplexWaiting")})).catch((e=>{this.errmsg=e.toString()}))},async upload(e){e&&(e.length+this.files.length>5&&(e=e.slice(0,5-this.files.length)),e.forEach((async e=>{let t={name:e.name,progress:(0,se.iH)(0),completed:(0,se.iH)(!1),controller:new AbortController,remoteName:""};this.files.push(t);let i=new FormData;i.append("file",e);let{data:s}=await ie()({method:"post",url:"http://"+location.host+"/api/upload",data:i,signal:t.controller.signal,onUploadProgress:e=>{t.progress.value=100*e.loaded/e.total},headers:{"Content-Type":"multipart/form-data"}});s.success&&(setTimeout((()=>{t.completed.value=!0}),300),t.remoteName=s.path)})))},submitPrint(){this.files.length&&qe("要打印这"+this.files.length+"个文件吗？").then((()=>{this.stage="submitting";let e=[];for(let t=this.files.length-1;t>=0;t--)e.push(this.files[t].remoteName);console.log(e),ie()({method:"post",url:"http://"+location.host+"/api/print",data:{config:{paths:e,duplex:this.duplex,mono:!this.color}}}).then((e=>{e.data.success?e.data.uuid?(localStorage.setItem("duplexUuid",e.data.uuid),this.stage="duplexWaiting"):this.stage="finished":(this.errmsg=e.data.err,this.stage="ready",this.update())})).catch((e=>{this.errmsg=e.toString(),this.stage="ready",this.update()}))}))},continueDuplex(){qe("你确定全部偶数页已经打印完毕，并且已经入内按照提示翻转纸张了吗？").then((()=>{this.stage="duplexSubmitting",ie()({method:"post",url:"http://"+location.host+"/api/duplex"}).then((e=>{e.data.success?this.stage="finished":(this.errmsg=e.data.err,this.stage="duplexWaiting",this.update())})).catch((e=>{this.errmsg=e.toString(),this.stage="duplexWaiting",this.update()}))}))},removeFile(e){qe("要删除列表中的“"+e.name+"”吗？").then((()=>{e.completed.value||e.controller.abort(),this.files.splice(this.files.indexOf(e),1)}))}},computed:{printReady(){if(this.files.length){for(let e=0;e<this.files.length;e++)if(!this.files[e].completed)return!1;return!0}return!1}},mounted(){this.stage="ready",this.update(),setInterval((()=>{this.update()}),5e3)}};const Me=(0,H.Z)(He,[["render",j]]);var Re=Me;(0,s.ri)(Re).mount("#app")}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,i),n.exports}i.m=e,function(){var e=[];i.O=function(t,s,a,n){if(!s){var l=1/0;for(d=0;d<e.length;d++){s=e[d][0],a=e[d][1],n=e[d][2];for(var r=!0,o=0;o<s.length;o++)(!1&n||l>=n)&&Object.keys(i.O).every((function(e){return i.O[e](s[o])}))?s.splice(o--,1):(r=!1,n<l&&(l=n));if(r){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,a,n]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,s){var a,n,l=s[0],r=s[1],o=s[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(o)var d=o(i)}for(t&&t(s);c<l.length;c++)n=l[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},s=self["webpackChunkprint_service_frontend"]=self["webpackChunkprint_service_frontend"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(5613)}));s=i.O(s)})();